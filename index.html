@bot.message_handler(content_types=['web_app_data'])
def handle_web_data(m):
    data = m.web_app_data.data
    uid = m.chat.id
    
    # Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„ÙØ© Ù…Ø¯ÙÙˆØ¹Ø©
    if data.startswith("PAID_"):
        prize_str = data.replace("PAID_", "")
        # Ø®ØµÙ… Ø³Ø¹Ø± Ø§Ù„Ù„ÙØ© (Ù…Ø«Ù„Ø§Ù‹ 30,000)
        cursor.execute("SELECT balance FROM users WHERE user_id=?", (uid,))
        balance = cursor.fetchone()[0]
        if balance < 30000:
            return bot.send_message(uid, "âŒ Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ Ù„Ø´Ø±Ø§Ø¡ Ù„ÙØ© (ØªØ­ØªØ§Ø¬ 30,000 NSP).")
        
        cursor.execute("UPDATE users SET balance = balance - 30000 WHERE user_id=?", (uid,))
        bot.send_message(uid, "ğŸ’ ØªÙ… Ø´Ø±Ø§Ø¡ Ù„ÙØ© Ù…Ø¯ÙÙˆØ¹Ø© Ø¨Ù€ 30,000 NSP")
        res = prize_str
    else:
        res = data

    # Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    if res == "Ø­Ø¸ Ø£ÙˆÙØ±":
        cursor.execute("UPDATE users SET free_spin = 1 WHERE user_id = ?", (uid,))
        bot.send_message(uid, "ğŸ˜¢ Ù„Ù„Ø£Ø³ÙØŒ Ø­Ø¸ Ø£ÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!")
    elif res == "RESPIN":
        cursor.execute("UPDATE users SET free_spin = 0 WHERE user_id = ?", (uid,))
        bot.send_message(uid, "ğŸ”„ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù„ÙØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©! Ø¬Ø±Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.")
    else:
        try:
            amt = int(res.replace(",", ""))
            cursor.execute("UPDATE users SET balance = balance + ?, free_spin = 1 WHERE user_id = ?", (amt, uid))
            bot.send_message(uid, f"ğŸŠ Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª Ø¨Ù€ {amt} NSP ÙˆØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ø±ØµÙŠØ¯Ùƒ.")
        except:
            bot.send_message(uid, f"ğŸ Ù„Ù‚Ø¯ ÙØ²Øª Ø¨Ù€: {res}")
            
    conn.commit()
